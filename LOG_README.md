# 日志系统使用说明

## 📝 概述

系统已集成完整的日志记录功能，所有用户操作都会自动记录到日志文件中，日志文件按IP地址和时间命名，保存在 `log/` 目录下。

## 🗂️ 日志文件命名规则

日志文件名格式：`IP_YYYYMMDD_HHMMSS.log`

例如：
- `127_0_0_1_20250904_140730.log` - 本地访问，2025年9月4日14:07:30
- `192_168_1_100_20250904_141500.log` - 内网IP，2025年9月4日14:15:00

## 📊 记录的日志内容

### 1. 文件上传日志
- 文件名、文件大小、上传时间
- 处理耗时
- 成功/失败状态

### 2. 文件处理日志
- 文件名、处理模式
- 处理耗时
- 成功/失败状态及错误信息

### 3. 批量处理日志
- 文件数量、处理模式
- 成功/失败数量统计
- 总处理耗时

### 4. 系统操作日志
- 用户IP地址
- 操作类型和状态
- 详细信息

## 🔍 查看日志的方法

### 方法1：使用日志查看脚本（推荐）

```bash
# 列出所有日志文件
python view_logs.py --list

# 查看指定日志文件（显示最后50行）
python view_logs.py --view 127_0_0_1_20250904_140730.log

# 查看指定日志文件（显示最后100行）
python view_logs.py --view 127_0_0_1_20250904_140730.log --lines 100

# 搜索包含关键词的日志
python view_logs.py --search "文件上传"

# 搜索指定IP的日志
python view_logs.py --ip "127.0.0.1"

# 清理30天前的旧日志
python view_logs.py --cleanup 30

# 查看帮助
python view_logs.py --help
```

### 方法2：直接查看日志文件

```bash
# 进入日志目录
cd log

# 列出所有日志文件
dir *.log

# 查看最新日志文件（Windows）
type 127_0_0_1_20250904_140730.log

# 查看最新日志文件（Linux/Mac）
tail -f 127_0_0_1_20250904_140730.log
```

## 📋 日志格式示例

```
2025-09-04 14:07:30 - INFO - [127.0.0.1] 文件上传 - 成功
2025-09-04 14:07:30 - INFO - [127.0.0.1] 处理耗时: 2.45秒
2025-09-04 14:07:30 - INFO - [127.0.0.1] 详细信息: {"filename": "sample.pdf", "file_size": 3987456, "file_size_mb": 3.8}
2025-09-04 14:07:32 - INFO - [127.0.0.1] 文件处理 - 成功
2025-09-04 14:07:32 - INFO - [127.0.0.1] 处理耗时: 1.87秒
2025-09-04 14:07:32 - INFO - [127.0.0.1] 详细信息: {"filename": "sample.pdf", "mode": "sn", "error": null}
```

## 🛠️ 日志管理

### 自动清理
系统会自动记录日志，但不会自动删除旧日志文件。建议定期清理：

```bash
# 清理30天前的日志
python view_logs.py --cleanup 30

# 清理7天前的日志
python view_logs.py --cleanup 7
```

### 手动清理
```bash
# 删除特定日志文件
del log\old_log_file.log

# 清空整个日志目录（谨慎操作）
rmdir /s log
mkdir log
```

## ⚠️ 注意事项

1. **日志文件会持续增长**：建议定期清理旧日志文件
2. **敏感信息**：日志中可能包含文件名等敏感信息，注意保护
3. **磁盘空间**：大量日志文件可能占用较多磁盘空间
4. **性能影响**：日志记录对系统性能影响很小，但大量日志文件可能影响查看效率

## 🔧 故障排除

### 日志文件无法创建
- 检查 `log/` 目录是否存在
- 检查目录权限
- 检查磁盘空间

### 日志内容为空
- 检查文件编码（应为UTF-8）
- 检查日志记录器配置
- 检查Flask应用是否正常运行

### 无法查看日志
- 确认日志文件存在
- 检查文件权限
- 使用 `python view_logs.py --list` 确认文件列表
